##-----------------------------------------------------------------------------
##
## time_series_analysis.R
##
## Script that performs a time series analysis of gene expression data
## with a time variable and optional additional factors.
##
## Author: Aarón García Blázquez
##
## Date: 25/09/2023
##
##-----------------------------------------------------------------------------

##-----------------------------------------------------------------------------
## Setup
##-----------------------------------------------------------------------------
# Clean environment
rm(list=ls())

# Load required packages
require(maSigPro)
##-----------------------------------------------------------------------------


##-----------------------------------------------------------------------------
## Data load
##-----------------------------------------------------------------------------
load(file="datamatrix.txt")
load(file="phenodata.txt")
##-----------------------------------------------------------------------------


##-----------------------------------------------------------------------------
## Time series analysis
##-----------------------------------------------------------------------------
# Make design matrix
design <- make.design.matrix(phenodata)

NBp <- p.vector(datamatrix, design, counts=TRUE)
NBt <- T.fit(NBp)
get <- get.siggenes(NBt, vars="all")
##-----------------------------------------------------------------------------


##-----------------------------------------------------------------------------
## Results plots
##-----------------------------------------------------------------------------
suma2Venn(get$summary[,c(2:4)])
##-----------------------------------------------------------------------------

# Clean environment
rm(list=ls())