---
title: "Expresión diferencial"
author: "Aarón García Blázquez"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, out.width = "100%", message = FALSE)
```

```{r packages}
require(dplyr)
require(DT)
require(kableExtra)
require(tidyr)
require(knitr)
require(data.table)
```

# Expresión diferencial {.tabset}

```{r}
tabla <- function(table) {
  table$table %>%
  DT::datatable(extensions = 'Buttons',
                options = list(pageLength = 10,                
                             dom = 'Blfrtip',
                             order = list(list(1, 'asc')),
                             buttons = list('colvis', 
                                             list(title = NULL,
                                                  extend = list('copy'),
                                                  exportOptions = list(columns = ":visible"),
                                                  text = "Copy"),
                                             list(title = NULL,
                                                  extend = list('csv'),
                                                  exportOptions = list(columns = ":visible"),
                                                  text = ".csv"),
                                             list(title = NULL,
                                                  extend = list('excel'),
                                                  exportOptions = list(columns = ":visible"),
                                                  text = "Excel"),
                                             list(title = "Informe de los resultados en formato pdf",
                                                  extend = list('pdf'),
                                                  exportOptions = list(columns = ":visible"),
                                                  text = ".pdf"),
                                             list(title = NULL,
                                                  extend = list('print'),
                                                  exportOptions = list(columns = ":visible"),
                                                  text = "Print")
                                              )),
              filter = "top", 
              escape = FALSE, 
              rownames = TRUE)  %>%
  formatSignif(columns = c(2:5), digits=3) %>%
  formatStyle('PValue', 
              fontWeight = styleInterval(0.05, c('bold', 'normal')), 
              color = styleInterval(0.05, c('green', 'black'))) %>%
  formatStyle('FDR', 
              fontWeight = styleInterval(0.05, c('bold', 'normal')), 
              color = styleInterval(0.05, c('green', 'black')))
}
```

## 72 hpf vs 48 hpf

```{r}
load("tt_72_48_filtered.RData")
tabla(tt_72_48)
```

```{r}
knitr::include_graphics("volcano_filtered_72 hpf vs 48 hpf.png")
```

## 120 hpf vs 72 hpf

```{r}
load("tt_120_72_filtered.RData")
tabla(tt_120_72)
```

```{r}
knitr::include_graphics("volcano_filtered_120 hpf vs 72 hpf.png")
```

## Adult vs 120 hpf

```{r}
load("tt_Adult_120_filtered.RData")
tabla(tt_adult_120)
```

```{r}
knitr::include_graphics("volcano_filtered_Adult vs 120 hpf.png")
```


# Número de genes{.tabset}

```{r}
# Genes upregulated en la estrategia control
n_ups_1_control <- length(which(tt_72_48$table$FDR < 0.05 & tt_72_48$table$logFC > 1.5))
n_ups_2_control <- length(which(tt_120_72$table$FDR < 0.05 & tt_120_72$table$logFC > 1.5))
n_ups_3_control <- length(which(tt_adult_120$table$FDR < 0.05 & tt_adult_120$table$logFC > 1.5))

# Genes downregulated en la estrategia control
n_downs_1_control <- length(which(tt_72_48$table$FDR < 0.05 & tt_72_48$table$logFC < -1.5))
n_downs_2_control <- length(which(tt_120_72$table$FDR < 0.05 & tt_120_72$table$logFC < -1.5))
n_downs_3_control <- length(which(tt_adult_120$table$FDR < 0.05 & tt_adult_120$table$logFC < -1.5))
```

```{r}
ups_1 <- c(n_ups_1_control, n_ups_2_control, n_ups_3_control)
downs_1 <- c(n_downs_1_control, n_downs_2_control, n_downs_3_control)

tab_1 <- data.frame(ups_1, downs_1)
colnames(tab_1) <- c("Up", "Down")
rownames(tab_1) <- c("72 hpf vs 48 hpf", "120 hpf vs 72 hpf", "Adult vs 120 hpf")
datatable(tab_1)
```
